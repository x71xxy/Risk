{% extends "base.html" %} {% block title %}设置新密码{% endblock %} {% block
content %}
<div class="auth-container">
  <div class="auth-box">
    <div class="auth-header">
      <h1>设置新密码</h1>
      <p class="subtitle">请设置您的新密码</p>
    </div>

    <form method="POST" class="auth-form">
      <div class="form-group">
        <label for="password">新密码</label>
        <div class="input-wrapper">
          <i class="icon">🔒</i>
          <input
            type="password"
            id="password"
            name="password"
            required
            placeholder="请输入新密码"
          />
        </div>
        <div class="password-requirements">
          <h4>密码要求：</h4>
          <ul>
            <li id="length-check"><i class="check-icon"></i>最少8个字符</li>
            <li id="upper-check"><i class="check-icon"></i>必须包含大写字母</li>
            <li id="lower-check"><i class="check-icon"></i>必须包含小写字母</li>
            <li id="number-check"><i class="check-icon"></i>必须包含数字</li>
            <li id="special-check">
              <i class="check-icon"></i>必须包含特殊字符(!@#$%^&*等)
            </li>
          </ul>
        </div>
      </div>

      <div class="form-group">
        <label for="confirm_password">确认新密码</label>
        <div class="input-wrapper">
          <i class="icon">🔒</i>
          <input
            type="password"
            id="confirm_password"
            name="confirm_password"
            required
            placeholder="请再次输入新密码"
          />
        </div>
        <div
          id="password-match-message"
          class="error-message"
          style="display: none"
        >
          两次输入的密码不一致
        </div>
      </div>

      <button type="submit" id="submit-btn" class="btn btn-primary">
        重置密码
      </button>
    </form>
  </div>
</div>

<style>
  /* 复用register.html的样式 */
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const passwordInput = document.getElementById("password");
    const confirmInput = document.getElementById("confirm_password");
    const submitBtn = document.getElementById("submit-btn");
    const matchMessage = document.getElementById("password-match-message");

    function checkPassword(password) {
      const checks = {
        length: password.length >= 8,
        upper: /[A-Z]/.test(password),
        lower: /[a-z]/.test(password),
        number: /\d/.test(password),
        special: /[!@#$%^&*(),.?":{}|<>]/.test(password),
      };

      document
        .getElementById("length-check")
        .classList.toggle("valid", checks.length);
      document
        .getElementById("upper-check")
        .classList.toggle("valid", checks.upper);
      document
        .getElementById("lower-check")
        .classList.toggle("valid", checks.lower);
      document
        .getElementById("number-check")
        .classList.toggle("valid", checks.number);
      document
        .getElementById("special-check")
        .classList.toggle("valid", checks.special);

      return Object.values(checks).every(Boolean);
    }

    function checkPasswordMatch() {
      const match = passwordInput.value === confirmInput.value;
      matchMessage.style.display = match ? "none" : "block";
      return match;
    }

    function validateForm() {
      const isPasswordValid = checkPassword(passwordInput.value);
      const isMatching = checkPasswordMatch();
      submitBtn.disabled = !(isPasswordValid && isMatching);
    }

    passwordInput.addEventListener("input", function () {
      checkPassword(this.value);
      validateForm();
    });

    confirmInput.addEventListener("input", function () {
      validateForm();
    });

    // 初始状态设置按钮为禁用
    submitBtn.disabled = true;
  });
</script>
{% endblock %}
